# ğŸ“˜ SUB-BAB 13.1: STRATEGI PENYELAMATAN: BACKUP, RPO, & RTO

## ğŸ¯ Tujuan Pembelajaran
Setelah mempelajari sub-bab ini, kamu akan mampu:
1.  Menjelaskan mengapa **Replikasi (Replica Set)** bukan strategi Backup dan tidak melindungi dari kesalahan manusia.
2.  Mendefinisikan dan membedakan dua metrik vital pemulihan bencana: **RPO (Recovery Point Objective)** dan **RTO (Recovery Time Objective)**.
3.  Memilih metode backup yang tepat (Hot Backup vs Cold Backup) untuk meminimalkan *downtime*.

---

## ğŸ”— Context & Hook
Bayangkan skenario horor ini: Seorang developer junior tidak sengaja menjalankan perintah `db.users.drop()` di server produksi.
* **Harapan:** "Tenang, kan kita punya 3 server Replica Set (Bab 7). Data pasti aman di server Secondary!"
* **Kenyataan:** Dalam hitungan milidetik, perintah `drop` tersebut direplikasi ke semua server Secondary. Data hilang di **SEMUA** server secara instan.

Di sinilah kita belajar pelajaran terpahit: **Replikasi Bukanlah Backup**. Replikasi menjamin ketersediaan jika server mati (Hardware Failure), tapi Backup menjamin data kembali jika data rusak atau terhapus (Logical/Human Error). Tanpa strategi backup yang benar, bisnis bisa bangkrut dalam semalam.

---

## ğŸ’¡ Analogi: Cermin vs. Album Foto
1.  **Replikasi = Cermin:**
    Jika wajahmu tergores luka, bayangan di cermin juga ikut tergores saat itu juga. Cermin tidak bisa menunjukkan wajah mulusmu 5 menit yang lalu. Replikasi menyalin "luka" (error) ke semua tempat.
2.  **Backup = Album Foto:**
    Album foto menyimpan potret wajahmu dari masa lalu (kemarin, 1 jam lalu). Jika wajahmu terluka sekarang, kamu masih punya bukti foto wajah mulusmu di album. Kamu bisa "mengembalikan" keadaan berdasarkan foto itu.

---

## ğŸ“š Inti Materi

### 1. Replikasi vs. Backup
* **Replikasi (Replica Set):**
    * *Tujuan:* **High Availability (HA)**. Agar sistem tidak mati saat satu server rusak.
    * *Kelemahan:* Menyalin kesalahan data secara instan.
* **Backup:**
    * *Tujuan:* **Disaster Recovery (DR)**. Agar data bisa dipulihkan ke titik waktu tertentu di masa lalu (*Point-in-Time*).
    * *Kelemahan:* Data tidak *real-time* (tergantung kapan terakhir backup diambil).

### 2. Metrik Vital: RPO & RTO
Saat merancang strategi backup, jangan tanya "Kapan kita backup?", tapi tanyakan dua hal ini kepada bisnis:
* **RPO (Recovery Point Objective):** "Berapa banyak data yang **boleh hilang**?"
    * Jika backup dilakukan setiap jam (jam 12, jam 1), dan bencana terjadi jam 12:59, kamu kehilangan data 59 menit. Apakah bisnis bisa terima itu?
    * *RPO Rendah (detik):* Mahal, butuh solusi canggih.
    * *RPO Tinggi (jam/hari):* Murah, metode backup standar.
* **RTO (Recovery Time Objective):** "Berapa lama sistem **boleh mati**?"
    * Setelah bencana, butuh berapa lama untuk *restore* data agar aplikasi nyala lagi? 1 jam? 1 hari?
    * Semakin cepat RTO yang diminta, semakin mahal infrastrukturnya (misal: *Hot Standby*).

### 3. Metode Backup: Hot vs. Cold
* **Cold Backup:** Mematikan database server, lalu menyalin file data.
    * *Pros:* Data pasti konsisten.
    * *Cons:* **Downtime** total. Tidak cocok untuk aplikasi modern 24/7.
* **Hot Backup (Snapshot/Logical):** Mengambil backup saat database sedang berjalan melayani pengguna.
    * *Snapshot:* Menggunakan fitur *Storage* (seperti EBS Snapshot di AWS) untuk memotret disk dalam hitungan detik. Cepat untuk RTO.
    * *Logical (mongodump):* Mengekspor data menjadi BSON. Lebih lambat *restore*-nya, tapi fleksibel (bisa restore per koleksi).

---

## ğŸ“± Contoh Penerapan: Bank Digital
Manajemen Bank menetapkan aturan ketat:
1.  **RPO = 0 Detik:** Tidak boleh ada satu pun transaksi nasabah yang hilang.
    * *Strategi:* Backup harian tidak cukup. Butuh **Continuous Archiving** dari Oplog (akan dibahas di Sub-Bab 13.2).
2.  **RTO = 15 Menit:** Jika data center kebakaran, sistem harus nyala lagi di lokasi lain dalam 15 menit.
    * *Strategi:* Menggunakan *Cloud Snapshot* otomatis yang bisa di-*mount* ke server baru dengan cepat, bukan *restore* manual file BSON yang butuh waktu berjam-jam.

---

## ğŸ“– Mini-Glossary
* **RPO (Recovery Point Objective):** Batas toleransi maksimum jumlah data yang hilang akibat bencana, diukur dalam satuan waktu (misal: "maksimal hilang 5 menit data").
* **RTO (Recovery Time Objective):** Batas toleransi maksimum waktu yang dibutuhkan untuk memulihkan sistem hingga beroperasi kembali setelah bencana.
* **Hot Backup:** Proses mencadangkan data saat database tetap aktif dan dapat diakses (online).
* **Snapshot:** Salinan instan dari keadaan sistem file atau volume penyimpanan pada titik waktu tertentu.

---

## ğŸ“ Evaluasi Singkat

### 5 Soal Pilihan Ganda (HOTS)

1.  **Analisis:** Sebuah perusahaan melakukan backup database setiap malam jam 00:00. Pada pukul 23:00 hari berikutnya, server meledak dan data hilang total. Berapa durasi data yang hilang (RPO aktual) dalam skenario ini?
    * a. 1 Jam.
    * b. 0 Jam (Tidak ada yang hilang).
    * c. 23 Jam (Data dari jam 00:01 sampai 23:00 hilang).
    * d. 24 Jam.
    * e. 12 Jam.

2.  **Konsep:** Mengapa memiliki *Replica Set* dengan 5 node (1 Primary, 4 Secondary) TIDAK bisa menggantikan fungsi Backup?
    * a. Karena 5 node terlalu sedikit.
    * b. Karena jika seseorang tidak sengaja menghapus koleksi di Primary, operasi penghapusan itu akan direplikasi ke ke-4 Secondary secara instan, menyebabkan kehilangan data total.
    * c. Karena Replica Set hanya untuk *read scaling*.
    * d. Karena MongoDB tidak stabil.
    * e. Karena Replica Set tidak menyimpan Oplog.

3.  **Strategi:** Bisnis E-Commerce menuntut agar jika terjadi kerusakan database, layanan harus kembali online dalam waktu kurang dari 30 menit. Metrik manakah yang sedang dibicarakan oleh bisnis?
    * a. RPO (Recovery Point Objective).
    * b. RTO (Recovery Time Objective).
    * c. ROI (Return on Investment).
    * d. TCO (Total Cost of Ownership).
    * e. TPS (Transactions Per Second).

4.  **Perbandingan:** Apa keuntungan utama menggunakan metode *Filesystem Snapshot* (Hot Backup) dibandingkan *Logical Backup* (`mongodump`) untuk database berukuran 1 Terabyte?
    * a. Snapshot lebih murah.
    * b. Snapshot biasanya jauh lebih cepat waktu *restore*-nya (RTO lebih baik) karena bekerja di level blok disk, sedangkan `mongodump` harus memproses ulang BSON satu per satu.
    * c. Snapshot bisa dibaca manusia.
    * d. `mongodump` tidak bisa dilakukan saat server nyala.
    * e. Snapshot tidak butuh disk.

5.  **Skenario:** Anda diminta merancang strategi backup untuk aplikasi "Log Sensor Suhu" yang datanya tidak terlalu kritis (boleh hilang data 1 hari), tapi sistemnya harus sangat murah. Strategi mana yang paling efisien?
    * a. Continuous Backup dengan RPO 1 detik (Mahal).
    * b. Backup Snapshot setiap 1 jam.
    * c. Backup harian sekali (Daily Backup) dengan retensi 7 hari. (Cukup memenuhi RPO 1 hari dengan biaya termurah).
    * d. Tidak perlu backup.
    * e. Replikasi ke 3 region berbeda.

### Kunci Jawaban
1.  **c** (Ini risiko backup berkala: data sejak backup terakhir hingga kejadian bencana akan hilang).
2.  **b** (Replikasi menyalin *state* termasuk *error* logis; Backup menyimpan *history*).
3.  **b** (Fokus pada durasi *downtime* pemulihan).
4.  **b** (Kecepatan *restore* data besar adalah keunggulan utama Snapshot).
5.  **c** (Sesuaikan biaya solusi dengan kebutuhan bisnis/RPO).

---

## ğŸš€ Mini Challenge
**Hitung Risiko:**
Perusahaanmu melakukan backup setiap jam 06.00 pagi.
1.  Jam 18.00 sore, hacker mengenkripsi database (Ransomware).
2.  Kamu terpaksa *restore* backup dari jam 06.00 pagi.
3.  Hitung: Berapa jam data transaksi yang hilang? (Jawab: 12 Jam).
4.  Jika dalam 1 jam ada transaksi senilai Rp 10 Juta, berapa kerugian perusahaan? (Jawab: Rp 120 Juta).
5.  Apakah biaya membuat sistem backup yang lebih sering (misal: per jam) lebih murah daripada kerugian Rp 120 Juta itu? (Inilah cara Arsitek berargumen).

---
*Backup harian kadang tidak cukup. Bagaimana jika kita ingin mengembalikan data ke detik ke-30 sebelum error terjadi? Ketik **"Lanjut"** untuk masuk ke **Sub-Bab 13.2: Mesin Waktu: Point-in-Time Recovery (PITR)**.*