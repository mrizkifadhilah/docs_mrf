# ðŸ“˜ SUB-BAB 13.3: RADAR SISTEM: MONITORING & ALERTING

## ðŸŽ¯ Tujuan Pembelajaran
Setelah mempelajari sub-bab ini, kamu akan mampu:
1.  Mengidentifikasi **Metrik Kunci** kesehatan database (CPU, RAM, Disk I/O, Connections) yang wajib dipantau.
2.  Menganalisis bahaya **Replication Lag** dan dampaknya terhadap konsistensi data di arsitektur *Replica Set*.
3.  Merancang strategi **Alerting** yang efektif (Signal vs Noise) agar tidak terkena "kelelahan alarm" (*Alert Fatigue*).

---

## ðŸ”— Context & Hook
Bayangkan kamu menyetir mobil dengan kecepatan 100 km/jam di jalan tol, tapi kaca depanmu ditutup cat hitam dan *dashboard*-mu mati total. Kamu tidak tahu seberapa cepat kamu melaju, berapa sisa bensin, atau apakah mesinmu kepanasan.

Menjalankan server database produksi tanpa **Monitoring** adalah tindakan bunuh diri yang sama. Kamu tidak akan tahu ada masalah sampai server benar-benar mati (*Crash*) dan pengguna mulai marah-marah di media sosial.

Monitoring adalah "Radar" yang memberitahumu: "Awas, 10 menit lagi bensin (Disk Space) habis!" atau "Awas, mesin (CPU) terlalu panas!". Dengan peringatan dini ini, kamu bisa mencegah bencana sebelum terjadi.

---

## ðŸ’¡ Analogi: Dashboard Mobil & Pasien ICU
1.  **Monitoring = Monitor Detak Jantung Pasien:**
    Di ICU, pasien dipasangi kabel yang memantau detak jantung dan oksigen secara *real-time*. Jika garisnya stabil, dokter tenang. Jika garisnya mulai tidak beraturan, dokter langsung bertindak *sebelum* jantung berhenti.
2.  **Alerting = Sirine Ambulans:**
    Monitoring hanya menampilkan data. **Alerting** adalah sirinenya. Jika detak jantung berhenti, mesin berbunyi *BEEP BEEP BEEP* keras untuk memanggil dokter. Tanpa sirine, dokter yang sedang tidur tidak akan tahu pasien dalam bahaya.

---

## ðŸ“š Inti Materi

### 1. Metrik Kunci (The Vital Signs)
Apa saja yang harus dipantau? Jangan pantau semuanya, fokus pada 4 pilar ini:

* **Hardware (Resource):**
    * **CPU:** Jika CPU > 80% terus-menerus, database mungkin kurang *power* atau ada kueri jahat yang memakan proses.
    * **Disk Space:** Ini pembunuh nomor 1. Jika disk penuh, database **langsung mati**.
    * **RAM:** MongoDB butuh RAM besar untuk *WiredTiger Cache*. Jika RAM habis, ia akan mulai membaca disk (lambat).
* **Database Internal:**
    * **Connections:** Lonjakan koneksi tiba-tiba (misal: dari 100 jadi 5.000) biasanya menandakan serangan DDoS atau aplikasi lupa menutup koneksi (*Connection Leak*).
    * **Replication Lag:** Selisih waktu antara Primary dan Secondary. Jika Lag tinggi, data di Secondary sudah basi (Stale), dan risiko kehilangan data saat *Failover* meningkat.
    * **OpCounters:** Jumlah operasi (Insert/Update/Delete) per detik. Jika tiba-tiba turun ke 0, berarti aplikasi macet.

### 2. Alerting: Signal vs. Noise
Tujuan Alerting adalah memanggil manusia saat ada bahaya nyata.
* **Bad Practice (Noise):** Mengirim email setiap kali CPU menyentuh 50%. Admin akan bosan dan mengabaikan email. Saat CPU menyentuh 100%, admin tidak sadar. Ini disebut **Alert Fatigue**.
* **Good Practice (Signal):**
    * Kirim notifikasi (Slack/SMS) **HANYA** jika:
        * Disk > 90% penuh.
        * Primary Node *Down*.
        * Replication Lag > 30 detik.
    * Untuk info remeh (CPU 60%), cukup catat di log, jangan bangunkan admin jam 2 pagi.

### 3. APM (Application Performance Monitoring)
Selain memantau server, pantau juga dari sisi kode aplikasi. Alat APM (seperti New Relic atau Datadog) bisa memberi tahu: *"Kueri `findUser` di baris 50 memakan waktu 3 detik."* Ini membantu menemukan akar masalah di kode, bukan di server.

---

## ðŸ“± Contoh Penerapan: Kasus Replication Lag
1.  **Kejadian:** Primary menerima banyak data (*Write Heavy*). Secondary lambat menyalin (*Lagging*).
2.  **Monitoring:** Grafik "Replication Lag" naik dari 0 detik menjadi 15 detik.
3.  **Alerting:** Sistem mendeteksi `Lag > 10s` dan mengirim peringatan ke grup Telegram DevOps.
4.  **Tindakan:** Tim DevOps melihat alert, lalu menyadari bahwa Secondary menggunakan harddisk yang lebih lambat. Mereka segera mengalihkan trafik baca (*Read Preference*) kembali ke Primary agar user tidak melihat data basi, lalu mengupgrade server Secondary.
5.  **Hasil:** Bencana data tidak konsisten berhasil dihindari.

---

## ðŸ“– Mini-Glossary
* **Monitoring:** Proses pengumpulan dan visualisasi data kinerja sistem secara berkelanjutan.
* **Alerting:** Mekanisme pengiriman notifikasi otomatis saat metrik melewati ambang batas (*threshold*) tertentu.
* **Replication Lag:** Penundaan waktu antara operasi tulis di Primary dan penerapannya di Secondary.
* **IOPS (Input/Output Operations Per Second):** Ukuran kecepatan baca/tulis disk.
* **Alert Fatigue:** Kondisi di mana admin menjadi tidak peka terhadap peringatan karena terlalu sering menerima peringatan palsu atau tidak penting.

---

## ðŸ“ Evaluasi Singkat

### 5 Soal Pilihan Ganda (HOTS)

1.  **Analisis:** Mengapa memantau **Disk Space** dianggap lebih kritis daripada memantau CPU?
    * a. Karena disk lebih mahal dari CPU.
    * b. Karena jika CPU 100%, sistem hanya melambat; tetapi jika Disk Penuh (100%), database akan *crash* (berhenti total) dan data bisa korup.
    * c. Karena disk menyimpan Oplog.
    * d. Karena CPU bisa *download* RAM.
    * e. Karena disk jarang penuh.

2.  **Skenario:** Anda menerima 100 email alert setiap hari yang mengatakan "CPU usage 40%". Akhirnya Anda membuat aturan di email untuk membuang alert tersebut ke folder Spam. Seminggu kemudian, server mati karena CPU 100% dan Anda tidak tahu. Fenomena apa ini?
    * a. Replication Lag.
    * b. Alert Fatigue (Kelelahan Alarm).
    * c. Disaster Recovery.
    * d. False Negative.
    * e. Hardware Failure.

3.  **Teknis:** Metrik apa yang paling tepat untuk melihat apakah aplikasi Anda mengalami kebocoran koneksi database (*Connection Leak*)?
    * a. IOPS.
    * b. Current Connections (Jika grafiknya naik terus seperti tangga dan tidak pernah turun).
    * c. Network Throughput.
    * d. Replication Oplog Window.
    * e. Memory Usage.

4.  **Konsep:** Apa risiko bisnis utama jika metrik **Replication Lag** diabaikan dan dibiarkan tinggi?
    * a. Server akan panas.
    * b. Pengguna yang membaca data dari Secondary akan melihat data lama/basi (Stale Data), dan jika Primary mati, data terbaru yang belum tersalin akan hilang permanen.
    * c. Backup akan gagal.
    * d. Indeks akan terhapus.
    * e. Biaya cloud menjadi murah.

5.  **Strategi:** Kapan waktu yang tepat untuk mengatur *Alert* berbunyi?
    * a. Saat metrik normal.
    * b. Saat metrik mencapai titik di mana intervensi manusia diperlukan segera (Actionable), misalnya Disk 90%.
    * c. Setiap 5 menit sekali.
    * d. Saat user komplain.
    * e. Saat developer sedang libur.

### Kunci Jawaban
1.  **b** (Kehabisan disk adalah kondisi *fatal error* bagi database).
2.  **b** (Terlalu banyak sinyal sampah menenggelamkan sinyal bahaya).
3.  **b** (Koneksi yang tidak ditutup akan menumpuk hingga batas server habis).
4.  **b** (Risiko *Data Loss* dan *Consistency*).
5.  **b** (Prinsip utama Alerting: *Actionable*).

---

## ðŸš€ Mini Challenge
**Setting Alarm:**
Bayangkan kamu admin database. Tentukan ambang batas (*Threshold*) untuk menyalakan sirine bahaya:
1.  **Disk Space:** Alert di angka berapa %? (Saran: 80% Warning, 90% Critical).
2.  **Replication Lag:** Alert di angka berapa detik? (Saran: > 10 detik).
3.  **Server Down:** Kapan? (Saran: SEGERA / 0 detik delay).

---
*Lampu indikator sudah menyala. Tapi bagaimana jika masalahnya ada pada kueri yang lambat? Ketik **"Lanjut"** untuk masuk ke **Sub-Bab 13.4: Troubleshooting: Menangani Slow Query & Contention**.*